name: AWTRIX Weather Sender

on:
  schedule:
    - cron: "*/10 * * * *"
  workflow_dispatch:

jobs:
  send-weather:
    runs-on: ubuntu-latest

    steps:
      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y mosquitto-clients jq

      - name: Fetch Weather and Send MQTT
        run: |
          RESPONSE=$(curl -s "http://api.openweathermap.org/data/2.5/weather?lat=25.020606&lon=55.270117&units=metric&appid=61e2218fd11404c46560eda9e65fd43d")

          TEMP=$(echo $RESPONSE | jq '.main.temp | round')
          HUM=$(echo $RESPONSE | jq '.main.humidity')

          MESSAGE="${TEMP}Â°C RH ${HUM}%"

          mosquitto_pub -h broker.hivemq.com -p 1883 -t mudon438weather92xk/notify -m "$MESSAGE"
